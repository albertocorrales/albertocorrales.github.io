<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="CI/CD pipelines-as-code with Nuke" /><meta property="og:locale" content="en" /><meta name="description" content="Introduction" /><meta property="og:description" content="Introduction" /><link rel="canonical" href="https://albertocorrales.com/posts/CI-CD-pipelines-as-code-with-Nuke-build/" /><meta property="og:url" content="https://albertocorrales.com/posts/CI-CD-pipelines-as-code-with-Nuke-build/" /><meta property="og:site_name" content="Alberto Corrales Garcia" /><meta property="og:image" content="https://albertocorrales.com/assets/img/2023-06-05/0.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-06-05T12:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://albertocorrales.com/assets/img/2023-06-05/0.png" /><meta property="twitter:title" content="CI/CD pipelines-as-code with Nuke" /><meta name="twitter:site" content="@albertocorralex" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-06-06T11:18:19+02:00","datePublished":"2023-06-05T12:00:00+02:00","description":"Introduction","headline":"CI/CD pipelines-as-code with Nuke","image":"https://albertocorrales.com/assets/img/2023-06-05/0.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://albertocorrales.com/posts/CI-CD-pipelines-as-code-with-Nuke-build/"},"url":"https://albertocorrales.com/posts/CI-CD-pipelines-as-code-with-Nuke-build/"}</script><title>CI/CD pipelines-as-code with Nuke | Alberto Corrales Garcia</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Alberto Corrales Garcia"><meta name="application-name" content="Alberto Corrales Garcia"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://albertocorrales.com/assets/img/profile_pic.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Alberto Corrales Garcia</a></div><div class="site-subtitle font-italic">Software Development, Architecture, Cloud and Technology</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/albertocorrales" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/albertocorralex" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['albertocorralesgarcia','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>CI/CD pipelines-as-code with Nuke</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>CI/CD pipelines-as-code with Nuke</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1685959200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 5, 2023 </em> </span> <span> Updated <em class="" data-ts="1686043099" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 6, 2023 </em> </span><div class="mt-3 mb-3"> <img data-src="/assets/img/2023-06-05/0.png" class="preview-img bg" alt="Preview Image" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/albertocorralex">Alberto Corrales Garcia</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1888 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><h1 id="introduction">Introduction</h1><p>In order to implement Continuous Integration and Continuous Delivery (CI/CD), we normally build pipelines. These pipelines are automatically triggered when we build new functionality, we push it into our source code repository, and it is merged into the master branch. As part of this process, we should have some automated or manual quality checks, such us code review, vulnerabilities scan, automatic testing, etc.</p><p>Once the pipeline is triggered, it will guide the delivery process and how the changes are being promoted across multiple environments.</p><p>Regarding Azure DevOps pipelines, it is a technology that has been evolving during the last few years as CI/CD has become more relevant. In the past, we used to have a build definition and a release definition, which were manually configured by dragging and dropping tasks. You can find more information about Azure DevOps pipelines in <a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/?view=azure-devops">this link</a>.</p><p>More recently, Azure Pipelines <a href="https://devblogs.microsoft.com/devops/announcing-general-availability-of-azure-pipelines-yaml-cd/">introduced the YAML pipelines</a>. This new way to define our pipelines was a very relevant improvement, because it allowed us to consistently reuse our pipeline definitions and define them dynamically. This is especially useful for complex pipelines, where we have multiple services or environments as part of our continuous delivery process.</p><p>In order to build YAML pipelines, we need to use an specific syntax, which allows us to define our pipeline. This language includes concepts such as stages, jobs, tasks, variables, etc. In addition, we can use <a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/process/expressions?view=azure-devops">some expressions</a> in order to dynamically build conditions, loops, built-in functions, etc.</p><h1 id="limitations-and-disadvantages-of-azure-devops-yaml-pipelines">Limitations and disadvantages of Azure DevOps YAML pipelines</h1><p>Azure DevOps YAML pipelines is an useful way to dynamically define our pipelines. However, in an enterprise context, where we might have very complex pipelines, YAML pipelines might have some limitations/disadvantages:</p><h2 id="1-yaml-pipelines-are-tightly-coupled-to-azure-devops"><span class="mr-2">1) YAML pipelines are tightly coupled to Azure DevOps</span><a href="#1-yaml-pipelines-are-tightly-coupled-to-azure-devops" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When we work with Azure DevOps YAML pipelines, we need to use their language. For that reason, if we want to run our pipeline in a different provider (like GitHub Actions), we won’t be able to do it.</p><h2 id="2-working-with-yaml-is-tedious-and-error-prone"><span class="mr-2">2) Working with YAML is tedious and error prone</span><a href="#2-working-with-yaml-is-tedious-and-error-prone" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>YAML is a human-readable data-serialization, which is commonly used for configuration files and in applications where the data is stored or transmitted. YAML has became very trendy, but it comes with some challenges, especially for complex YAML files or when we introduce programming features, such as the expressions in Azure DevOps. When we are configuring YAML, we might need to deal with issues such as indentation errors, typos or having huge files that are a mix of expressions, scripts, etc. As a result, maintaining those YAML files might be a real challenge. We can find this situation not only in Azure DevOps, but in other technologies like Terraform or Docker.</p><p><img data-src="/assets/img/2023-06-05/1_1.PNG" alt="" data-proofer-ignore></p><h2 id="3-we-cannot-test-our-pipelines-locally"><span class="mr-2">3) We cannot test our pipelines locally</span><a href="#3-we-cannot-test-our-pipelines-locally" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>One of the biggest limitations of Azure DevOps pipelines, is the fact that we cannot test or run our pipelines locally. In order words, when we are updating or creating a new pipeline, we need to edit our YAML file, push the pipeline definition to our repository, and run the pipeline in order to test it.</p><p>During this process, we will often find out that there were some issues with our pipeline definition, so we need to repeat this process over and over. As a consequence, working with YAML pipelines might slow us down.</p><h2 id="4-yaml-size-limit-of-2mbs"><span class="mr-2">4) YAML size limit of 2MBs</span><a href="#4-yaml-size-limit-of-2mbs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When we are building YAML pipelines, we normally use templates, so we can reuse the same set of tasks, jobs or stages across our pipeline. Using templates is really helpful to make our templates simpler and more maintainable. However, when Azure DevOps triggers a build, it will generate an extended YAML file for the pipeline.</p><p>As an example, if we have a template to deploy a lambda function with length 30 lines of YAML and we use that template to deploy 10 lambdas in our pipeline, it will generate an extended YAML file with 300 lines. This situation can get worse and worse when we are working with complex pipelines, where our CI/CD process includes many services or many environments. Working with the extended YAML file can be a serious limitation for complex pipelines, as Azure DevOps imposes a <a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/process/templates?view=azure-devops#imposed-limits">size limit of 2MB</a> for the extended YAML file.</p><p>In order to try to mitigate this limitation, we can try to work with the <a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/yaml-schema/jobs-job-strategy?view=azure-pipelines">strategy matrix</a>. When we use the strategy matrix, the extended YAML won’t duplicate the YAML. However, it only works at job level and it might be not very effective if our pipeline is using different templates for building/deploying different type of projects.</p><h1 id="using-nuke-build">Using Nuke Build</h1><p>When it comes to tools for replacing YAML in Azure DevOps pipelines, there are multiple projects which follow different approaches, but with the same goal. Some examples are:</p><ul><li><a href="https://www.youtube.com/watch?v=ZeGMTuuEKxM">Cake Build</a><li><a href="https://github.com/adamralph/bullseye">Bullseye</a><li><a href="https://github.com/sharpliner/sharpliner">Sharpliner</a><li><a href="https://nuke.build/">Nuke Build</a></ul><p>Most of these tools use C# as programming language, as it is the most popular language for developers who work with Microsoft technologies. This is a great advantage, as C# is a rich strongly typed language and there are libraries to do anything you can need your pipelines.</p><p>Apart from that, these tools provide an SDK that will make easier building pipelines.</p><p>From the tools mentioned above, <code class="language-plaintext highlighter-rouge">Nuke Build</code> is the most popular and advanced one. Some of the features that make <code class="language-plaintext highlighter-rouge">Nuke Build</code> a great choice are:</p><ul><li>It is very easy to install and start working with it.<li>It is agnostic, so you can run it on any providers.<li>It provides a rich developing experience and the SDK includes common tasks you might need in your pipeline.<li>You can run and debug your pipelines locally.<li>It provides a CLI which is really helpful to set new projects, run a plan, etc.<li>It provides support for the most popular CI/CD vendors.</ul><h2 id="how-to-setup-a-new-nuke-project"><span class="mr-2">How to setup a new Nuke project</span><a href="#how-to-setup-a-new-nuke-project" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Setting up a new Nuke project is quite straightforward. First of all, you have to install the global tool with the following command:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">dotnet</span><span class="w"> </span><span class="nx">tool</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="nx">Nuke.GlobalTool</span><span class="w"> </span><span class="nt">--global</span><span class="w">
</span></pre></table></code></div></div><p>Then, you can setup your nuke project with the command:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">nuke</span><span class="w"> </span><span class="p">:</span><span class="nx">setup</span><span class="w">
</span></pre></table></code></div></div><p><img data-src="/assets/img/2023-06-05/1.PNG" alt="" data-proofer-ignore></p><p>This is how it looks the example build created by Nuke</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">Nuke.Common</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Build</span> <span class="p">:</span> <span class="n">NukeBuild</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="kt">int</span> <span class="nf">Main</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">Execute</span><span class="p">&lt;</span><span class="n">Build</span><span class="p">&gt;(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Compile</span><span class="p">);</span>

    <span class="p">[</span><span class="nf">Parameter</span><span class="p">(</span><span class="s">"Configuration to build - Default is 'Debug' (local) or 'Release' (server)"</span><span class="p">)]</span>
    <span class="k">readonly</span> <span class="n">Configuration</span> <span class="n">Configuration</span> <span class="p">=</span> <span class="n">IsLocalBuild</span> <span class="p">?</span> <span class="n">Configuration</span><span class="p">.</span><span class="n">Debug</span> <span class="p">:</span> <span class="n">Configuration</span><span class="p">.</span><span class="n">Release</span><span class="p">;</span>

    <span class="n">Target</span> <span class="n">Clean</span> <span class="p">=&gt;</span> <span class="n">_</span> <span class="p">=&gt;</span> <span class="n">_</span>
        <span class="p">.</span><span class="nf">Before</span><span class="p">(</span><span class="n">Restore</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">Executes</span><span class="p">(()</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Clean"</span><span class="p">);</span>
        <span class="p">});</span>

    <span class="n">Target</span> <span class="n">Restore</span> <span class="p">=&gt;</span> <span class="n">_</span> <span class="p">=&gt;</span> <span class="n">_</span>
        <span class="p">.</span><span class="nf">Executes</span><span class="p">(()</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Restore"</span><span class="p">);</span>
        <span class="p">});</span>

    <span class="n">Target</span> <span class="n">Compile</span> <span class="p">=&gt;</span> <span class="n">_</span> <span class="p">=&gt;</span> <span class="n">_</span>
        <span class="p">.</span><span class="nf">DependsOn</span><span class="p">(</span><span class="n">Restore</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">Executes</span><span class="p">(()</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Compile"</span><span class="p">);</span>
        <span class="p">});</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Now we can run the build just with the command <code class="language-plaintext highlighter-rouge">nuke</code> or from VisualStudio, we can open the project and run it as any other dotnet program. Apart from that, we can easily set breaking points and debug our nuke builds in a very convenient way.</p><p><img data-src="/assets/img/2023-06-05/3.PNG" alt="" data-proofer-ignore></p><p>Apart from this, we can check the plan of our build. This can be very useful for complex builds. In order to do so, we can run the command:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">nuke</span><span class="w"> </span><span class="nt">--plan</span><span class="w">
</span></pre></table></code></div></div><p>And we will display the flow diagram of our build:</p><p><img data-src="/assets/img/2023-06-05/4.PNG" alt="" data-proofer-ignore></p><h2 id="integration-between-nuke-and-azure-devops"><span class="mr-2">Integration between Nuke and Azure DevOps</span><a href="#integration-between-nuke-and-azure-devops" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If you are working with a very simple pipeline, Nuke might be all you need to build it. However, for more complex pipelines, you might need a pipeline with multiple jobs or stages running in parallel. For these scenarios, you can still work with Nuke to build the tasks of a job, but combine it with the concepts provided by Azure DevOps such as stages, jobs, etc. This will allow you to run different jobs/stages in parallel (this is <a href="https://github.com/nuke-build/nuke/issues/162">a limitation</a> for nuke at the moment). In addition, you can leverage the permissions model for Azure DevOps, which can be handy if you need approvals for promoting your changes to production environments.</p><p>By following this approach, we would have a small part of YAML that defines the structure of your pipeline with the stages/jobs, but most of the pipeline logic would be done by Nuke projects.</p><p><img data-src="/assets/img/2023-06-05/2.png" alt="" data-proofer-ignore></p><p>In this case, for each job, our YAML template would look similar to this:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="na">parameters</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Paramter1</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Parameter2</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">job</span><span class="pi">:</span> <span class="s">myJob</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">bash</span><span class="pi">:</span> <span class="s">./build.sh</span>
        <span class="na">displayName</span><span class="pi">:</span> <span class="s">CI</span>
        <span class="na">workingDirectory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$(Build.SourcesDirectory)/Build/MyProjectExample"</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">Paramter1</span><span class="pi">:</span> <span class="s">${ { parameters.Paramter1 } }</span>
          <span class="na">Parameter2</span><span class="pi">:</span> <span class="s">${ { parameters.Parameter2 } }</span>
</pre></table></code></div></div><p>On the other hand, if we want to get rid of the whole YAML, we could use <a href="https://github.com/sharpliner/sharpliner">Sharpliner</a> to implement the definition of stages and jobs and combine it with Nuke. Sharpliner generates Azure DevOps pipelines in YAML from C#. For that reason, it can be helpful to reduce the errors writing YAML, but we could still hit the size limit for YAML if we overuse it.</p><h2 id="nuke-build-best-practices"><span class="mr-2">Nuke build best practices</span><a href="#nuke-build-best-practices" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In this section we will review some good practices and recommendations based on my experience working with Nuke:</p><h3 id="1-reuse-targets"><span class="mr-2">1) Reuse targets:</span><a href="#1-reuse-targets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In order to prevent code duplication, we should always build our targets as generic targets and reuse them whenever it is possible. You can always use parameters to customize certain options in your target.</p><h3 id="2-use-dependencies-properly"><span class="mr-2">2) Use dependencies properly:</span><a href="#2-use-dependencies-properly" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The dependencies model in Nuke can be a little complex, especially when you have multiple combinations of dependencies between your targets. As a general rule, using TryAfter and TryBefore should be the way to define our dependencies, so we don’t trigger Targets that we are not scheduled in the pipeline project.</p><p>DependentFor and DependOn should be used only if there is a strict dependency and that dependency will never change or be optional. You have more info about Nuke dependencies in <a href="https://nuke.build/docs/fundamentals/targets/#dependencies">this link</a>.</p><h3 id="3-idempotent-builds"><span class="mr-2">3) Idempotent builds:</span><a href="#3-idempotent-builds" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Our pipelines should be idempotent, so no matter how many times we run them, they should produce the same outcome. In order to achieve this, we can easily clean up temporary files that we create during the build process with the method EnsureCleanDirectory provided by Nuke.</p><h3 id="4-single-responsibility-in-targets"><span class="mr-2">4) Single-responsibility in targets:</span><a href="#4-single-responsibility-in-targets" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>When we are building targets, these targets should follow <a href="https://en.wikipedia.org/wiki/Single-responsibility_principle">the Single-responsibility principle</a>, so we don’t have targets that are doing more than one thing. On the other hand, we should also prevent building targets that are too small and they don’t provide any value by themselves.</p><h1 id="conclusions">Conclusions</h1><p>As we have seen in this article, working with YAML to build our CI/CD pipelines can bring some challenges and limitations. In order to deal with these issues, Nuke allows us to build our pipelines as code, so our pipelines will be less error prone, more maintainable and easier to develop/debug.</p><p>Using Nuke has a learning curve, but compared to other frameworks it is the most advanced one at the moment and it brings a very good developing experience, especially if you are already using C# in your projects.</p><p>However, depending on the complexity of your build, you might need to find a balance and use a mix of Nuke and the CI/CD engine definition. By following this approach, you would have Nuke to cover most of the logic in our pipelines, but you could also leverage features such us jobs/stages parallelization, permissions management, etc.</p></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/azure-devops/" class="post-tag no-text-decoration" >Azure DevOps</a> <a href="/tags/ci-cd/" class="post-tag no-text-decoration" >CI/CD</a> <a href="/tags/pipelines/" class="post-tag no-text-decoration" >pipelines</a> <a href="/tags/nuke/" class="post-tag no-text-decoration" >Nuke</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=CI%2FCD+pipelines-as-code+with+Nuke+-+Alberto+Corrales+Garcia&url=https%3A%2F%2Falbertocorrales.com%2Fposts%2FCI-CD-pipelines-as-code-with-Nuke-build%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=CI%2FCD+pipelines-as-code+with+Nuke+-+Alberto+Corrales+Garcia&u=https%3A%2F%2Falbertocorrales.com%2Fposts%2FCI-CD-pipelines-as-code-with-Nuke-build%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Falbertocorrales.com%2Fposts%2FCI-CD-pipelines-as-code-with-Nuke-build%2F&text=CI%2FCD+pipelines-as-code+with+Nuke+-+Alberto+Corrales+Garcia" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Getting-starting-with-MCPs/">Getting started with MCPs, add super powers to your AI assistant</a><li><a href="/posts/Build-your-own-MCP/">Level Up Your AI Skills, Build a Custom MCP from Scratch</a><li><a href="/posts/Copier-template-projects/">Build Microservices at speed light with Copier</a><li><a href="/posts/CI-CD-pipelines-as-code-with-Nuke-build/">CI/CD pipelines-as-code with Nuke</a><li><a href="/posts/Working-with-event-sourcing-and-web-sockets/">Working with Event Sourcing, CQRS and Web Sockets on AWS</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/ai-assistant/">AI assistant</a> <a class="post-tag" href="/tags/ai/">AI</a> <a class="post-tag" href="/tags/architecture/">Architecture</a> <a class="post-tag" href="/tags/claude/">Claude</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/cqrs/">CQRS</a> <a class="post-tag" href="/tags/event-sourcing/">event sourcing</a> <a class="post-tag" href="/tags/eventstoredb/">EventStoreDB</a> <a class="post-tag" href="/tags/llm/">LLM</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Build-your-own-MCP/"><div class="card-body"> <em class="small" data-ts="1752400800" data-df="ll" > Jul 13, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Level Up Your AI Skills, Build a Custom MCP from Scratch</h3><div class="text-muted small"><p> Introduction In our previous article, we explored the Model Context Protocol (MCP) and learned how to use existing MCP servers to extend Claude’s capabilities. Today, we’ll take the next step and ...</p></div></div></a></div><div class="card"> <a href="/posts/Getting-starting-with-MCPs/"><div class="card-body"> <em class="small" data-ts="1750586400" data-df="ll" > Jun 22, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Getting started with MCPs, add super powers to your AI assistant</h3><div class="text-muted small"><p> Introduction As AI assistants become increasingly integrated into our development workflows, the need for standardized ways to extend their capabilities has become paramount. Enter the Model Conte...</p></div></div></a></div><div class="card"> <a href="/posts/Copier-template-projects/"><div class="card-body"> <em class="small" data-ts="1737885600" data-df="ll" > Jan 26, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Build Microservices at speed light with Copier</h3><div class="text-muted small"><p> Build Microservices at speed light with Copier Introduction Templating tools are critical in modern microservices architecture, solving key challenges in rapid and consistent software development...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Working-with-event-sourcing-and-web-sockets/" class="btn btn-outline-primary" prompt="Older"><p>Working with Event Sourcing, CQRS and Web Sockets on AWS</p></a> <a href="/posts/Copier-template-projects/" class="btn btn-outline-primary" prompt="Newer"><p>Build Microservices at speed light with Copier</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/albertocorralex">Alberto Corrales Garcia</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/ai-assistant/">AI assistant</a> <a class="post-tag" href="/tags/ai/">AI</a> <a class="post-tag" href="/tags/architecture/">Architecture</a> <a class="post-tag" href="/tags/claude/">Claude</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/cqrs/">CQRS</a> <a class="post-tag" href="/tags/event-sourcing/">event sourcing</a> <a class="post-tag" href="/tags/eventstoredb/">EventStoreDB</a> <a class="post-tag" href="/tags/llm/">LLM</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
